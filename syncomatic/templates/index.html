{% extends "base.html" %}
{% block content %}
    {% if g.user.is_authenticated() %}
        <div class="logged_in_index_container group">
            <div class="logged_in group">
                <span>Hi, {{user.email}}</span>
                <a class="sign-out" href="{{url_for('logout')}}">Sign out</a>
            </div>

            <form id="create_folder" method="post" action="{{url_for('create_folder')}}">
                {{form.hidden_tag()}}
                <input id="hidden_directory_name" type='hidden' name='directory' value="test_dir">
            </form>
            <input type='button' id="create_folder_button" onclick="create_folder()" value="New Folder">

            <form class="upload_form" action="{{url_for('index')}}" method=post enctype=multipart/form-data>
                {{form.hidden_tag()}}
                <div class="upload_form_container">
                    {{form.upload(class="transparent-stype")}}
                    <input class="transparent-style" type="submit" value="Upload"></input>
                    {% for error in form.errors.upload %}
                        <span class="form_errors">{{error}}</span>
                    {% endfor %}
                </div>
            </form>

            <span class="current_path">{{ path_msg }}</span>
            <table>
                <thead>
                    <tr>
                        <td>Name</td>
                        <td>Size</td>
                        <td>Created</td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                        <tr {% if loop.index % 2 != 0 %}
                                class="light"
                            {% else %}
                                class="dark"
                            {% endif %}
                        >
                        {% if file.is_dir %}
                            <td class="folder_file">{{file.name}}</td>
                            <!-- TODO folder js -->
                        {% else %}
                            <td class="regular_file">{{file.name}}</td>
                        {% endif %}
                            <td>{{file.size|filesizeformat}}</td>
                            <td>{{file.creation_date}}</td>
                            <td>
                                <div class="buttons_container">
                                    <div class="button button-download group">
                                        <form method="get" action="{{url_for('getFile')}}">
                                            <input type="hidden" name="path" value={{path}}>
                                            <input type="hidden" name="index" value={{files.index(file)}}>
                                            <input class="transparent-style" type=submit value=Download>
                                        </form>
                                    </div>
                                    <div class="button button-delete group">
                                        <form method="get" action="{{url_for('deleteFile')}}">
                                            <input type="hidden" name="path" value={{path}}>
                                            <input type="hidden" name="index" value={{files.index(file)}}>
                                            <input class="transparent-style" type=submit value=Delete>
                                        </form>
                                    </div>
                                </div>
                            </td>
                        </td>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="not_logged_in_index_container group">
             <a href="{{url_for('register')}}"><button class="register shadow border-radius"><span >JOIN</span></button></a>
             <a href="{{url_for('login')}}" class="login">LOG IN</a>
        </div>
    {% endif %}
{% endblock %}
